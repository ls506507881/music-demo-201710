<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./playlist.css">
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./home.css">
    <title>歌单列表</title>
</head>

<body>
    <div class="plWarp">
        <section class="plTop">
            <div id="plTopbg" >
                <!-- <div class="plTopbg" style="background-image:url(//oxkl41ihc.bkt.clouddn.com/%E5%BF%98%E8%AE%B0.jpg) no-repeat;"></div> -->
            </div>
            
            <div class="formDate">
                <div id="fromCover" class="fromCover">
                    <!-- <img src="//oxkl41ihc.bkt.clouddn.com/%E5%BF%98%E8%AE%B0.jpg" alt="歌单封面"> -->
                </div>
                <div id="fromTitle" class="fromTitle">
                </div>
            </div>
        </section>
        <section class="plIntro">
            <div class="pltags">
                标签：
                <em href="#">华语</em>
                <em href="#">流行</em>
                <em href="#">伤感</em>
            </div>
            <div id="pltagsIntro" class="pltagsIntro plIntroHide">
                <span>介绍： -<br/></span>
                <br/>
                <span>红尘中，能够将一个人轻轻放在心中，寂然相爱，默然相守，于我，已然是一种幸福。<br/></span>
                <br/>
                <span>一路走来相依相伴，牵念，能望穿最深的流年，相守，能温暖岁月所有的薄凉，<br/></span>
                <br/>
                <span>今生能够遇见你已是圆满，心深处，念你如昔。<br/></span>
                <br/>
                <span>因为想一个人而寂寞<br/></span>
                <br/>
                <span>因为爱一个人而温柔<br/></span>
                <br/>
                <span>因为有一个梦而执着<br/></span>
                <br/>
                <span>因为等一个人而折磨<br/></span>
                <br/>
                <span>因为想一个人而解脱<br/></span>
                <br/>
                <span>因为爱一个人而宽容<br/></span>
                <br/>
                <span>因为有一个梦而放纵<br/></span>
                <br/>
                <span>因为等一个人而漂泊<br/></span>
                <br/>
                <span>Ps:摘自范玮琪《因为》封面：谢雨泓</span>
            </div>
            <div id="pltagsToggle" class="pltagsToggle">
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#icon-down"></use>
                </svg>
            </div>
        </section>
        <section class="songs">
            <h3 class="plsongsTitle">歌曲列表</h3>
            <ol id="plsongs" class="list hotlist">
            </ol>
        </section>
        <section class="plDn"></section>
    </div>
    <script src="//at.alicdn.com/t/font_434816_g8gpd8s381c0izfr.js"></script>
    <script src="./vendors/av-min.js"></script>
    <script src="./scripts/av.js"></script>
</body>
<script src="./vendors/jquery.min.js"></script>
<script>
    var $pltagsIntro = $('#pltagsIntro');
    var $plToggleSvg = $('#pltagsToggle > svg')
    $($pltagsIntro).click(function(){
        $pltagsIntro.toggleClass('plIntroHide')
        $plToggleSvg.toggleClass('flipy')
    });

    let $olplSongs = $('ol#plsongs')
    var queryplaylist = new AV.Query('Song');
    var cql = 'select * from Song where hot != true';
    AV.Query.doCloudQuery(cql).then(function (data) {
      $('#songs-loading').remove()
          var results = data.results;
          for( var i = 0; i < results.length; i++){
            let song = results[i].attributes
            let li = `
            <li>
                <a href="./song.html?id=${results[i].id}">
                    <div class="num">${[i+1]}</div>
                    <h3>${song.name}<span>${song.reMark}</span>
                    </h3>
                    <p>张信哲 - 时间都去哪儿了</p>
                    <div class="playButton" href="#">
                        <svg class="icon icon-play" aria-hidden="true">
                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-play"></use>
                        </svg>
                    </div>
                </a>
            </li>
            `
        $olplSongs.append(li)
        }
    }, function (error) {
    console.log('获取最新音乐出错')
    });





    function getParameterByName(name,url){
            if(!url) url = window.location.href;
            name = name.replace(/[\[\]]/g,"\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if(!results) return null;
            if(!results[2]) return ' ';
            return decodeURIComponent(results[2].replace(/\+/g," "));
        }

        let id = getParameterByName('id');
        var $fromCover = $('#fromCover')
        var $plTopbg = $('#plTopbg')
        var $fromTitle = $('#fromTitle')
        var query123 = new AV.Query('Playlist');
        query123.get(id).then(function (song) {
            let {url,musicListName,avatar,uploader,volume} = song.attributes
            let cover = `
                <div class="superscript">歌单</div>
                <div class="amount">
                    <svg class="icon icon-listen" aria-hidden="true">
                        <use xlink:href="#icon-listen"></use>
                    </svg>
                    <span>${volume}</span>
                </div>
                <img src="${url}" alt="歌单封面">
            `
            let bg = `
                <div class="plTopbg" style="background:url(${url}) no-repeat;"></div>
            `
            let fromtitle = `
                <h2>${musicListName}</h2>
                <div class="avatar">
                    <a href="#">
                        <img src="${avatar}" alt="上传者头像">
                        <span>${uploader}</span>
                    </a>
                </div>
            `
            $fromCover.append(cover)
            $plTopbg.append(bg)
            $fromTitle.append(fromtitle)
        }, function (error) {
            alert('出错了')
        });
</script>
</html>